<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2017-02-09 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170209" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MaPSeq &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Massively Parallel Sequencing</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.renci.org" id="bannerRight">
                                                                                                <img src="../images/renci-logo.png"  alt="RENCI"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2017-02-09
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.6.51-SNAPSHOT
                      </li>
                      
              
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="../index.html" title="About">
          <span class="none"></span>
        About</a>
            </li>
                
      <li>
  
                          <a href="../faq.html" title="FAQ">
          <span class="none"></span>
        FAQ</a>
            </li>
                
      <li>
  
                          <a href="../download.html" title="Download">
          <span class="none"></span>
        Download</a>
            </li>
                              <li class="nav-header">Manual</li>
                              
      <li>
  
                          <a href="../manual/building.html" title="Building">
          <span class="none"></span>
        Building</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Modules</a>
          </li>
                
      <li>
  
                          <a href="../manual/workflows.html" title="Workflows">
          <span class="none"></span>
        Workflows</a>
            </li>
                
      <li>
  
                          <a href="../manual/pipelines.html" title="Pipelines">
          <span class="none"></span>
        Pipelines</a>
            </li>
                
      <li>
  
                          <a href="../manual/pipeline-archetype.html" title="Pipeline Archetype">
          <span class="none"></span>
        Pipeline Archetype</a>
            </li>
                
      <li>
  
                          <a href="../manual/commands.html" title="Commands">
          <span class="none"></span>
        Commands</a>
            </li>
                
      <li>
  
                          <a href="../manual/reporting.html" title="Reporting">
          <span class="none"></span>
        Reporting</a>
            </li>
                
      <li>
  
                          <a href="../manual/ws-clients.html" title="Web Service clients">
          <span class="none"></span>
        Web Service clients</a>
            </li>
                              <li class="nav-header">Migration</li>
                              
      <li>
  
                          <a href="../migration/04to05.html" title="v0.4 to v0.5">
          <span class="none"></span>
        v0.4 to v0.5</a>
            </li>
                              <li class="nav-header">Pipelines</li>
                              
      <li>
  
                          <a href="../pipelines/unc.html" title="UNC Pipelines">
          <span class="none"></span>
        UNC Pipelines</a>
            </li>
                
      <li>
  
                          <a href="../pipelines/renci.html" title="RENCI Pipelines">
          <span class="none"></span>
        RENCI Pipelines</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="../project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            
  
    <div class="section">
<h2><a name="Modules"></a>Modules</h2>
      
<p>A Module in MaPSeq is what Workflows are made of, comprising
      the vertexes of a graph.  They are the units of work in a
      Workflow that run third party code/libraries.  There are three
      lifecycle events to a Module.  These include input validation,
      execution, and output validation.  A Module will make a number
      of web service calls, mostly for provenance.  If the &quot;--dryRun&quot;
      argument is present, no web service calls are made.</p>

      
<div class="section">
<h3><a name="Getting_started"></a>Getting started</h3>
	
<p>Each class intending to be a Module must extend the
	edu.unc.mapseq.module.Module class and have the
	edu.unc.mapseq.module.annotations.Application annotation.  The
	Module class itself is an abstract class that extends
	java.util.Callable &amp; returns a ModuleOutput class.  There
	are two types of ModuleOutput classes (ShellModuleOutput &amp;
	DefaultModuleOutput).  The AbstractModule.call() method, which
	returns a ShellModuleOutput class, uses reflection to
	construct the command line arguments to run a third party
	library.</p>
      </div>

      
<div class="section">
<h3><a name="Code_Generation"></a>Code Generation</h3>
	
<p>Code generation is used to abstract away the boilerplate
	code that handles the three lifecycle events.  The intent of
	this was to make the creation of Modules as clean/easy as
	possible for intented users.  The code generation library used
	is called <a class="externalLink" href="https://codemodel.java.net/">CodeModel</a>.
	For each Module, there is a cooresponding CLI class to house
	the execution boilerplate code.  For example, if an Echo class
	exists, a coorespoding EchoCLI will be generated and compiled
	at build time.  Each CLI class will expose a Module's member
	variables as command line arguments &amp; return exit code -1
	if there any runtime exceptions.</p>
      </div>

      
<div class="section">
<h3><a name="Validation"></a>Validation</h3>
	
<p>Module validation is done using <a class="externalLink" href="http://hibernate.org/validator/">Hibernate's
	Validator</a>, as well as a number of custom validation
	annotations, on a per member variable basis.  Here is an
	example from the Echo module:</p>

<div>
<pre>
@Size(min = 1, message = &quot;Greeting is required&quot;, groups = InputValidations.class)
@NotNull(message = &quot;Greeting is required&quot;, groups = InputValidations.class)
@InputArgument(delimiter = &quot;&quot;)
private String greeting;

@FileIsReadable(message = &quot;File does not exist&quot;, groups = OutputValidations.class)
@NotNull(message = &quot;Output file name is required&quot;, groups = InputValidations.class)
@OutputArgument(redirect = true, persistFileData = true)
private File output;
</pre></div>
        
<p>What the combination of validation annotations for the
        <i>greeting</i> variable means is that <i>greeting</i>
        cannot be null &amp; the value must be longer than 1 byte in
        size.  The validation annotations of the output variable
        requires that the output File be readable and not null.  Note
        that the annotations are grouped by InputValidations &amp;
        OutputValidations classes.  These two classes are used to
        identify which set of member variables will be validated &amp;
        when.  If there are validation violations, then the Module
        will exit with a &quot;message&quot; and a exit code of -1.</p>
      </div>

      
<div class="section">
<h3><a name="Putting_it_all_together....Echo_Module"></a>Putting it all together....Echo Module</h3>
	
<p>Here is the full Echo Module class:</p>

<div>
<pre>
@Application(name = &quot;Echo&quot;)
@Executable(value = &quot;/bin/echo&quot;)
public class Echo extends Module {

    @Size(min = 0, message = &quot;Greeting is required&quot;, groups = InputValidations.class)
    @NotNull(message = &quot;Greeting is required&quot;, groups = InputValidations.class)
    @InputArgument(delimiter = &quot;&quot;)
    private String greeting;

    @FileIsReadable(message = &quot;File does not exist&quot;, groups = OutputValidations.class)
    @NotNull(message = &quot;Output file name is required&quot;, groups = InputValidations.class)
    @OutputArgument(redirect = true, persistFileData = true)
    private File output;

    public Echo() {
        super();
    }

    @Override
    public Class&lt;?&gt; getModuleClass() {
        return Echo.class;
    }

    public String getGreeting() {
        return greeting;
    }

    public void setGreeting(String greeting) {
        this.greeting = greeting;
    }

    public File getOutput() {
        return output;
    }

    public void setOutput(File output) {
        this.output = output;
    }

}
</pre></div>
      </div>

      
<div class="section">
<h3><a name="Running_Echo_Module"></a>Running Echo Module</h3>
	
<p>Running with no arguments:</p>

<div>
<pre>
$ ./mapseq-run-module.sh edu.unc.mapseq.module.core.EchoCLI 
The value of class edu.unc.mapseq.module.core.Echo.output was: null.  Output file name is required
The value of class edu.unc.mapseq.module.core.Echo.greeting was: null.  Greeting is required
usage: EchoCLI
 -?,--help                                          print this help
                                                    message
    --dryRun                                        no web service calls &amp;
                                                    echo command line
                                                    without running
    --greeting &lt;greeting&gt;
    --output &lt;output&gt;
    --persistFileData                               persist FileData's if
                                                    they exist
    --serializeFile &lt;serializeFile&gt;           Serialize File
    --workflowRunAttemptId &lt;workflowRunAttemptId&gt;   WorkflowRunAttempt
                                                    identifier
</pre></div>	
	
<p>Output with no input:</p>

<div>
<pre>
$ ./mapseq-run-module.sh edu.unc.mapseq.module.core.EchoCLI --output /tmp/zipitydoda.txt
The value of class edu.unc.mapseq.module.core.Echo.greeting was: null.  Greeting is required
usage: EchoCLI
 -?,--help                                          print this help
                                                    message
    --dryRun                                        no web service calls &amp;
                                                    echo command line
                                                    without running
    --greeting &lt;greeting&gt;
    --output &lt;output&gt;
    --persistFileData                               persist FileData's if
                                                    they exist
    --serializeFile &lt;serializeFile                 Serialize File
    --workflowRunAttemptId &lt;workflowRunAttemptId&gt;   WorkflowRunAttempt
                                                    identifier
</pre></div>	
	
<p>Doing a dry run:</p>

<div>
<pre>
$ ./mapseq-run-module.sh edu.unc.mapseq.module.core.EchoCLI --dryRun --greeting Hello World --output /tmp/zipitydoda.txt
/bin/echo Hello World &gt; /tmp/zipitydoda.txt
</pre></div>	
      </div>

    </div>
  

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2017
                        <a href="http://www.unc.edu/">UNC</a>.
            All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
